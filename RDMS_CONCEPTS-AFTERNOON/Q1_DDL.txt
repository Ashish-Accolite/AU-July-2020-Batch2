CREATE SCHEMA `HOSPITAL_DB` ;

CREATE TABLE `HOSPITAL_DB`.`EMPLOYEE` (
  `EMP_ID` INT NOT NULL,
  `NAME` NVARCHAR(30) NOT NULL,
  `CONTACT_NUM` NVARCHAR(10) NOT NULL,
  `EMP_ADDRESS` NVARCHAR(60) NULL,
  `GENDER` TINYINT NULL,
  `SALARY` DECIMAL(15,2) NOT NULL,
  `EMP_TYPE` NVARCHAR(15) NOT NULL,
  `PROFESSION` NVARCHAR(15) NOT NULL,
  `DEPT` NVARCHAR(15) NOT NULL,
  PRIMARY KEY (`EMP_ID`));

CREATE TABLE `HOSPITAL_DB`.`PATIENT` (
  `PID` INT NOT NULL,
  `NAME` VARCHAR(20) NOT NULL,
  `ADDRESS` VARCHAR(60) NULL,
  `GENDER` TINYINT NULL,
  `CONTACT_NUM` VARCHAR(10) NOT NULL,
  PRIMARY KEY (`PID`));

CREATE TABLE `HOSPITAL_DB`.`RECORD` (
  `RECORD_NO` INT NOT NULL,
  `PID` INT NOT NULL,
  `DESCRIPTION` VARCHAR(100) NOT NULL,
  `ADMIN_DATE` DATETIME NOT NULL,
  `DISCHARGE_DATE` DATETIME NOT NULL,
  PRIMARY KEY (`RECORD_NO`));

ALTER TABLE `HOSPITAL_DB`.`RECORD` 
ADD INDEX `PID_idx` (`PID` ASC) VISIBLE;
;
ALTER TABLE `HOSPITAL_DB`.`RECORD` 
ADD CONSTRAINT `PID`
  FOREIGN KEY (`PID`)
  REFERENCES `HOSPITAL_DB`.`PATIENT` (`PID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

CREATE TABLE `HOSPITAL_DB`.`ROOM` (
  `ROOM_ID` INT NOT NULL,
  `PID` INT NOT NULL,
  `DOC_ID` INT NOT NULL,
  `ROOM_TYPE` VARCHAR(30) NOT NULL,
  `PERIOD` INT NOT NULL,
  PRIMARY KEY (`ROOM_ID`));

ALTER TABLE `HOSPITAL_DB`.`ROOM` 
ADD CONSTRAINT `EMP_ID`
  FOREIGN KEY (`DOC_ID`)
  REFERENCES `HOSPITAL_DB`.`EMPLOYEE` (`EMP_ID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `HOSPITAL_DB`.`ROOM` 
CHANGE COLUMN `PID` `PATIENT_ID` INT NOT NULL ;

ALTER TABLE `HOSPITAL_DB`.`RECORD` 
DROP FOREIGN KEY `PID`;
ALTER TABLE `HOSPITAL_DB`.`RECORD` 
CHANGE COLUMN `PID` `FK_RECORD_PID` INT NOT NULL ;
ALTER TABLE `HOSPITAL_DB`.`RECORD` 
ADD CONSTRAINT `PID`
  FOREIGN KEY (`FK_RECORD_PID`)
  REFERENCES `HOSPITAL_DB`.`PATIENT` (`PID`);

ALTER TABLE `HOSPITAL_DB`.`ROOM` 
DROP FOREIGN KEY `EMP_ID`;
ALTER TABLE `HOSPITAL_DB`.`ROOM` 
CHANGE COLUMN `PATIENT_ID` `FK_ROOM_PID` INT NOT NULL ,
CHANGE COLUMN `DOC_ID` `FK_ROOM_DOC_ID` INT NOT NULL ;
ALTER TABLE `HOSPITAL_DB`.`ROOM` 
ADD CONSTRAINT `EMP_ID`
  FOREIGN KEY (`FK_ROOM_DOC_ID`)
  REFERENCES `HOSPITAL_DB`.`EMPLOYEE` (`EMP_ID`);

ALTER TABLE `HOSPITAL_DB`.`ROOM` 
ADD CONSTRAINT `FK_PID_ROOM`
  FOREIGN KEY (`FK_ROOM_PID`)
  REFERENCES `HOSPITAL_DB`.`PATIENT` (`PID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

CREATE TABLE `HOSPITAL_DB`.`MEDICINE` (
  `CODE` INT NOT NULL,
  `NAME` VARCHAR(30) NOT NULL,
  `PRICE` DECIMAL(10,2) NOT NULL,
  PRIMARY KEY (`CODE`));

CREATE TABLE `HOSPITAL_DB`.`TREATMENT` (
  `FK_TREATMENT_CODE` INT NOT NULL,
  `FK_TREATMENT_PID` INT NOT NULL,
  `FK_TREATMENT_DOC_ID` INT NOT NULL);

ALTER TABLE `HOSPITAL_DB`.`TREATMENT` 
ADD CONSTRAINT `FK_TREATMENT_PID`
  FOREIGN KEY (`FK_TREATMENT_PID`)
  REFERENCES `HOSPITAL_DB`.`PATIENT` (`PID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `FK_TREATMENT_EMP_ID`
  FOREIGN KEY (`FK_TREATMENT_DOC_ID`)
  REFERENCES `HOSPITAL_DB`.`EMPLOYEE` (`EMP_ID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `CODE`
  FOREIGN KEY (`FK_TREATMENT_CODE`)
  REFERENCES `HOSPITAL_DB`.`MEDICINE` (`CODE`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

CREATE TABLE `HOSPITAL_DB`.`ROOM_DUTY` (
  `ROOM_ID` INT NOT NULL,
  `NURSE_ID` INT NOT NULL);

ALTER TABLE `HOSPITAL_DB`.`ROOM_DUTY` 
ADD CONSTRAINT `FK_ROOM_DUTY_EMP_ID`
  FOREIGN KEY (`NURSE_ID`)
  REFERENCES `HOSPITAL_DB`.`EMPLOYEE` (`EMP_ID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION,
ADD CONSTRAINT `ROOM_ID`
  FOREIGN KEY (`ROOM_ID`)
  REFERENCES `HOSPITAL_DB`.`ROOM` (`ROOM_ID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `HOSPITAL_DB`.`RECORD` 
ADD COLUMN `FK_RECORD_DOC_ID` INT NOT NULL AFTER `DISCHARGE_DATE`;

ALTER TABLE `HOSPITAL_DB`.`RECORD` 
ADD CONSTRAINT `FK_RECORD_EMP_ID`
  FOREIGN KEY (`FK_RECORD_DOC_ID`)
  REFERENCES `HOSPITAL_DB`.`EMPLOYEE` (`EMP_ID`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `HOSPITAL_DB`.`RECORD` 
CHANGE COLUMN `ADMIN_DATE` `ADMIT_DATE` DATETIME NOT NULL ;

ALTER TABLE `HOSPITAL_DB`.`ROOM` 
DROP FOREIGN KEY `EMP_ID`;
ALTER TABLE `HOSPITAL_DB`.`ROOM` 
DROP COLUMN `FK_ROOM_DOC_ID`,
DROP INDEX `EMP_ID_idx` ;
;
